<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>FunFun Paper Review Repo Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
      line-height: 1.5;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
    }
    .desc {
      color: #555;
      margin-bottom: 1.5rem;
    }
    ul {
      list-style: none;
      padding-left: 1rem;
      border-left: 1px solid #ddd;
      margin-left: 0.5rem;
    }
    li {
      margin: 0.15rem 0;
    }
    .folder::before {
      content: "ğŸ“ ";
    }
    .file::before {
      content: "ğŸ“„ ";
    }
    a {
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .loading {
      color: #777;
    }
    .error {
      color: #b00;
      font-weight: 600;
    }
    .toolbar {
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <h1>FunFun Paper Review â€“ Repo êµ¬ì¡° ë³´ê¸°</h1>
  <p class="desc">
    ì´ í˜ì´ì§€ëŠ” <code>hanwo-ol/funfunpaperreview</code> ë ˆí¬ì˜ í´ë”/íŒŒì¼ êµ¬ì¡°ë¥¼
    GitHub APIë¡œ ì‹¤ì‹œê°„ ê°€ì ¸ì™€ì„œ ë³´ì—¬ì¤ë‹ˆë‹¤.
  </p>

  <div class="toolbar">
    ğŸ”— <a href="https://github.com/hanwo-ol/funfunpaperreview" target="_blank">
      GitHubì—ì„œ ë ˆí¬ ë³´ê¸°
    </a>
    &nbsp;Â·&nbsp;
    ğŸ“ <a href="/funfunpaperreview/blog/">ë¸”ë¡œê·¸(í¬ìŠ¤íŠ¸ ëª©ë¡)ë¡œ ì´ë™</a>
  </div>

  <div id="tree" class="loading">ë ˆí¬ êµ¬ì¡° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

  <script>
    const owner = "hanwo-ol";
    const repo = "funfunpaperreview";

    // íŠ¸ë¦¬ì—ì„œ ìˆ¨ê¸°ê³  ì‹¶ì€ ì´ë¦„ë“¤
    const HIDDEN_NAMES = new Set([
      "index.html",
      "viewer.html",
      "_layouts",
      "blog"
    ]);

    async function fetchDir(path = "") {
      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
      const res = await fetch(apiUrl);
      if (!res.ok) {
        throw new Error("GitHub API ì˜¤ë¥˜: " + res.status);
      }
      return await res.json();
    }

    function createTreeList(items, currentPath = "") {
      const ul = document.createElement("ul");

      // í´ë” ë¨¼ì €, ê·¸ ë‹¤ìŒ íŒŒì¼
      items.sort((a, b) => {
        if (a.type === b.type) return a.name.localeCompare(b.name);
        return a.type === "dir" ? -1 : 1;
      });

      for (const item of items) {
        // ìˆ¨ê¸°ê³  ì‹¶ì€ íŒŒì¼/í´ë” ê±¸ëŸ¬ë‚´ê¸°
        if (item.name.startsWith(".")) continue; // ìˆ¨ê¹€ íŒŒì¼
        if (HIDDEN_NAMES.has(item.name)) continue;
        if (["README.md"].includes(item.name)) continue; // ì›í•˜ë©´ ì œê±°í•´ë„ ë¨

        const li = document.createElement("li");
        const link = document.createElement("a");
        link.textContent = item.name;

        if (item.type === "dir") {
          li.classList.add("folder");
          // GitHub ì›¹ì—ì„œ í´ë” ì—´ê¸° (Ctrl/Cmd+í´ë¦­ ì‹œ)
          link.href = `https://github.com/${owner}/${repo}/tree/main/${item.path}`;
          link.target = "_blank";
          li.appendChild(link);

          const childContainer = document.createElement("div");
          childContainer.style.marginLeft = "0.5rem";
          li.appendChild(childContainer);

          let isLoaded = false;
          link.addEventListener("click", async (e) => {
            if (e.metaKey || e.ctrlKey) return; // ìƒˆ íƒ­ ì—´ê¸° ìœ ì§€

            e.preventDefault();
            if (isLoaded) {
              childContainer.style.display =
                childContainer.style.display === "none" ? "block" : "none";
              return;
            }
            childContainer.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
            try {
              const children = await fetchDir(item.path);
              childContainer.textContent = "";
              childContainer.appendChild(createTreeList(children, item.path));
              isLoaded = true;
            } catch (err) {
              childContainer.textContent = "í•˜ìœ„ í´ë”ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
            }
          });
        } else {
          li.classList.add("file");

          // .md íŒŒì¼ì€ viewer.htmlì—ì„œ ë Œë”ë§í•´ì„œ ë³´ê¸°
          if (item.name.endsWith(".md")) {
            const encodedPath = encodeURIComponent(item.path);
            link.href = `/funfunpaperreview/viewer.html?path=${encodedPath}`;
            link.target = "_self";
          } else {
            // ê·¸ ì™¸ íŒŒì¼ì€ GitHubì—ì„œ ë³´ê¸°
            link.href = `https://github.com/${owner}/${repo}/blob/main/${item.path}`;
            link.target = "_blank";
          }

          li.appendChild(link);
        }

        ul.appendChild(li);
      }

      return ul;
    }

    async function init() {
      const treeDiv = document.getElementById("tree");
      try {
        const rootItems = await fetchDir("");
        treeDiv.classList.remove("loading");
        treeDiv.textContent = "";
        treeDiv.appendChild(createTreeList(rootItems));
      } catch (err) {
        treeDiv.classList.remove("loading");
        treeDiv.classList.add("error");
        treeDiv.textContent = "ë ˆí¬ êµ¬ì¡°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ë³´ì„¸ìš”.";
        console.error(err);
      }
    }

    init();
  </script>
</body>
</html>
