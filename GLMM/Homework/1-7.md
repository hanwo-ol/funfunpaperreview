### **문제 분석 및 데이터**

이 문제는 운동 여부(X), 심장질환 여부(Y), 그리고 연령대(Z)라는 세 변수 간의 관계를 분석하는 것입니다. 연령대(Z)는 제3의 변수, 즉 **통제 변수(control variable)** 또는 **층화 변수(stratifying variable)** 역할을 합니다.

**주어진 데이터:**
* **40대 (Z=1)**: $2 \times 2$ 표
 
| | 운동함(X=1) | 운동 안함(X=0) |
| :--- | :--- | :--- |
| **예(Y=1)** | 18 | 30 |
| **아니오(Y=0)**| 82 | 70 |

*   **60대 (Z=2)**: $2 \times 2$ 표

| | 운동함(X=1) | 운동 안함(X=0) |
| :--- | :--- | :--- |
| **예(Y=1)** | 35 | 55 |
| **아니오(Y=0)**| 65 | 45 |

### **a. 각 연령 별 $2 \times 2$ 분할표에서 운동여부와 심장질환 발생 간의 오즈비를 구하라.**

#### **식 (Formulation)**

각 연령대($k=1, 2$)별 부분표(partial table)에 대한 **조건부 오즈비(conditional odds ratio)** $\theta_{XY(k)}$를 계산합니다. $2 \times 2$ 표의 셀 빈도를 $n_{ij}$라고 할 때, 오즈비는 교차곱으로 계산됩니다.

$$ \hat{\theta}_{XY(k)} = \frac{n_{11k} \times n_{22k}}{n_{12k} \times n_{21k}} $$

여기서,
*   $i=1$: 운동함, $i=2$: 운동 안 함
*   $j=1$: 심장질환 예, $j=2$: 심장질환 아니오
*   $k$: 연령대 (1=40대, 2=60대)

**40대 ($k=1$)의 오즈비**:

$$ \hat{\theta}_{XY(1)} = \frac{(\text{운동함, 예}) \times (\text{운동 안 함, 아니오})}{(\text{운동함, 아니오}) \times (\text{운동 안 함, 예})} = \frac{18 \times 70}{82 \times 30} $$

**60대 ($k=2$)의 오즈비**:

$$ \hat{\theta}_{XY(2)} = \frac{35 \times 45}{65 \times 55} $$

#### **R 코드 (R Code)**

```R
# 1. 각 연령대별로 데이터 행렬 생성
# 40대 (행: 운동여부, 열: 심장질환여부)
table_40s <- matrix(c(18, 82, 30, 70), nrow = 2, byrow = TRUE,
                    dimnames = list(Exercise = c("Yes", "No"), Disease = c("Yes", "No")))

# 60대
table_60s <- matrix(c(35, 65, 55, 45), nrow = 2, byrow = TRUE,
                    dimnames = list(Exercise = c("Yes", "No"), Disease = c("Yes", "No")))

# 2. 각 표에 대한 오즈비 계산 함수
calculate_or <- function(tbl) {
  # tbl[1,1]은 Yes-Yes, tbl[2,2]는 No-No
  return((tbl[1, 1] * tbl[2, 2]) / (tbl[1, 2] * tbl[2, 1]))
}

# 3. 오즈비 계산
or_40s <- calculate_or(table_40s)
or_60s <- calculate_or(table_60s)

# 4. 결과 출력
print("a. 각 연령대별 오즈비")
print(paste("40대 오즈비:", or_40s))
print(paste("60대 오즈비:", or_60s))
```

### **b. Cochran-Mantel-Haenszel 검정을 수행하고 그 결과를 해석하라.**

#### **식 (Formulation)**

CMH 검정은 **XY 조건부 독립성(Conditional Independence)**을 검정합니다.
*   **귀무가설 ($H_0$)**: 연령대(Z)를 통제했을 때, 운동 여부(X)와 심장질환(Y)은 서로 독립이다. (즉, 모든 층에서 공통 오즈비가 1이다.)
*   **검정 통계량**:

$$ \text{CMH} = \frac{[\sum_k(n_{11k} - E(n_{11k}))]^2}{\sum_k \text{Var}(n_{11k})} $$

이 통계량은 자유도 1인 $\chi^2$ 분포를 근사적으로 따릅니다.

#### **R 코드 (R Code)**

```R
# 1. 데이터를 3차원 배열(array) 형태로 변환
# 배열 차원: (행:운동, 열:심장질환, 층:연령대)
cmh_array <- array(c(18, 82, 30, 70, # 40대
                     35, 65, 55, 45),# 60대
                   dim = c(2, 2, 2),
                   dimnames = list(
                     Exercise = c("Yes", "No"),
                     Disease = c("Yes", "No"),
                     Age = c("40s", "60s")
                   ))

# 2. CMH 검정 수행
cmh_test_b <- mantelhaen.test(cmh_array, correct = FALSE) # 연속성 수정 없이

# 3. 결과 출력
print("b. Cochran-Mantel-Haenszel 검정 결과")
print(cmh_test_b)
```

### **c. Breslow-Day 검정을 수행하고 그 결과를 해석하라.**

#### **식 (Formulation)**

Breslow-Day 검정은 **오즈비의 동질성(Homogeneity of Odds Ratios)**을 검정합니다.
*   **귀무가설 ($H_0$)**: 모든 층(연령대)에 걸쳐 XY 조건부 오즈비는 모두 동일하다. ($\theta_{XY(1)} = \theta_{XY(2)}$)
*   **검정 통계량**:

$$ X^2_{BD} = \sum_{k=1}^{K} \frac{[n_{11k} - E(n_{11k} | \hat{\theta}_{MH})]^2}{\text{Var}(n_{11k} | \hat{\theta}_{MH})} $$

여기서 기대값과 분산은 공통 오즈비 추정치($\hat{\theta}_{MH}$)가 주어졌을 때의 비중심 초기하분포(non-central hypergeometric distribution)로부터 계산됩니다.
    이 통계량은 자유도 $K-1$인 $\chi^2$ 분포를 근사적으로 따릅니다. 여기서는 df = $2-1=1$입니다.

#### **R 코드 (R Code)**

```R
# R의 기본 stats 패키지에는 Breslow-Day 검정 함수가 직접 포함되어 있지 않습니다.
# `DescTools` 또는 `vcd`와 같은 패키지를 사용해야 합니다.
# install.packages("DescTools")
library(DescTools)

# 1. 3차원 배열 데이터 사용 (b에서 생성한 cmh_array)

# 2. Breslow-Day 검정 수행
breslow_day_test_c <- BreslowDayTest(cmh_array)

# 3. 결과 출력
print("c. Breslow-Day 오즈비 동질성 검정 결과")
print(breslow_day_test_c)
```

### **d. b와 c의 결과를 종합하여, 연구자가 운동과 심장질환 발생 사이의 관계를 일반화할 수 있는지 논하라.**

#### **논리 전개 (Formulation)**

이 질문은 b와 c의 통계적 결과를 바탕으로 종합적인 결론을 내리는 서술형 문제입니다.

1.  **b의 결과 (CMH 검정)**: 조건부 독립성을 검정합니다.
    *   만약 P-값이 작으면 (예: < 0.05), "연령대를 통제하더라도 운동과 심장질환 사이에는 유의미한 연관성이 존재한다"고 결론 내립니다.
    *   이때의 공통 오즈비 추정치($\hat{\theta}_{MH}$)는 이 연관성의 평균적인 크기와 방향을 나타냅니다.

2.  **c의 결과 (Breslow-Day 검정)**: 오즈비의 동질성을 검정합니다.
    *   만약 P-값이 크면 (예: > 0.05), "두 연령대에서 운동의 효과(오즈비)가 통계적으로 다르다고 말할 근거가 없다"고 결론 내립니다. 즉, **균일 연관성(homogeneous association)** 가설을 기각하지 못합니다.
    *   만약 P-값이 작으면, "운동의 효과가 40대와 60대에서 다르다"고 결론 내립니다. 즉, 연령대가 **효과 변경자(effect modifier)** 역할을 합니다.

3.  **종합 결론**:
    *   **"일반화(generalize)"**할 수 있다는 것은, 연령대에 관계없이 운동의 효과를 하나의 값(공통 오즈비)으로 요약할 수 있다는 의미입니다.
    *   따라서, **c의 Breslow-Day 검정에서 P-값이 커서 동질성 가설을 기각하지 못하고**, **b의 CMH 검정에서 P-값이 작아 유의미한 공통 연관성이 확인**된다면, 연구자는 "연령대와 무관하게 운동은 심장질환 위험을 낮추는(또는 높이는) 효과가 있으며, 그 효과의 크기는 공통 오즈비 $\hat{\theta}_{MH}$로 요약할 수 있다"고 일반화하여 결론 내릴 수 있습니다.
    *   만약 c에서 P-값이 작아 동질성 가설이 기각된다면, 일반화하여 하나의 값으로 요약하는 것은 부적절하며, "운동의 효과는 연령대에 따라 다르다"고 보고해야 합니다. (예: "40대에서는 오즈비가 얼마이고, 60대에서는 얼마이다.")

#### **R 코드 (R Code)**
이 질문은 서술형이므로, b와 c의 R 코드 결과를 바탕으로 위의 논리 전개에 따라 해석을 작성하면 됩니다.
