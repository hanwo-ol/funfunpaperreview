### **문제 분석 및 모델 설정**

이 문제는 환자의 수술 시 연령(Age, 양적 변수)이 수술 후 kyphosis 발생 여부(Kyphosis, 이항 변수)에 미치는 영향을 분석하는 것입니다. 로지스틱 회귀 모델을 사용합니다.

Kyphosis 발생 확률을 $\pi$, 수술 시 연령을 $x$라고 할 때, 로지스틱 회귀 모델을 설정할 수 있습니다.

### **a. 나이를 예측변수로 하는 로지스틱 회귀모형 적합 및 유의성 검정**

#### **식 (Formulation)**

1.  **단순 로지스틱 회귀 모델**:

$$ \text{logit}[\pi(x)] = \log\left(\frac{\pi(x)}{1-\pi(x)}\right) = \alpha + \beta x $$

    여기서 $\alpha$는 절편, $\beta$는 연령의 효과를 나타냅니다.

2.  **유의성 검정**: 연령의 효과가 유의한지 검정하는 것은 귀무가설 $H_0: \beta = 0$을 검정하는 것과 같습니다. 이는 여러 방법으로 수행할 수 있습니다.
    *   **왈드 검정 (Wald Test)**: 검정 통계량 $z = \hat{\beta} / \text{SE}(\hat{\beta})$를 계산하고, 이 값이 표준정규분포에서 얼마나 극단적인지 P-값으로 평가합니다.
    *   **가능도비 검정 (Likelihood Ratio Test)**: $H_0$에 해당하는 모델($\text{logit}(\pi) = \alpha$)과 대립가설에 해당하는 모델($\text{logit}(\pi) = \alpha + \beta x$)을 비교합니다. 검정 통계량 $G^2 = -2(L_0 - L_1)$은 자유도 1인 $\chi^2$ 분포를 근사적으로 따릅니다.

#### **R 코드 (R Code)**

```R
# 1. 데이터 입력
# kyphosis 발생 그룹(1)과 미발생 그룹(0)으로 나누어 데이터 생성
age_present <- c(12, 15, 42, 52, 59, 73, 82, 91, 96, 105, 114, 120, 121, 128, 130, 139, 139, 157)
age_absent <- c(1, 1, 2, 8, 11, 18, 22, 31, 37, 61, 72, 81, 97, 112, 118, 127, 131, 140, 151, 159, 177, 206)

# 데이터 프레임 생성
kyphosis_data <- data.frame(
  Age = c(age_present, age_absent),
  Kyphosis = c(rep(1, length(age_present)), rep(0, length(age_absent)))
)

# 2. 단순 로지스틱 회귀 모델 적합
model_a <- glm(Kyphosis ~ Age, data = kyphosis_data, family = binomial(link = "logit"))

# 3. 모델 요약 및 유의성 검정 결과 출력
# summary() 함수는 각 계수에 대한 Wald 검정 결과를 포함함
print("a. 단순 로지스틱 회귀 모델 적합 결과")
print(summary(model_a))

# 가능도비 검정을 위한 축소 모델 적합
model_a0 <- glm(Kyphosis ~ 1, data = kyphosis_data, family = binomial(link = "logit"))
# 가능도비 검정 수행
print("--- 가능도비 검정 결과 ---")
print(anova(model_a0, model_a, test = "LRT"))
```

### **b. 데이터 그림으로 나타내고, 두 그룹의 나이 dispersion 차이 기술**

#### **식 (Formulation)**

데이터를 시각화하고 dispersion(분산)의 차이를 기술하는 것은 주로 탐색적 데이터 분석(EDA)에 해당합니다.
1.  **시각화**: Kyphosis 발생 여부(Y축)를 연령(X축)에 대해 산점도로 그릴 수 있습니다. 하지만 Y가 0/1이므로 명확하지 않을 수 있습니다. 대신, 각 그룹(Kyphosis=0, Kyphosis=1)에 대한 연령의 분포를 **상자 그림(Boxplot)**이나 **밀도 그림(Density Plot)**으로 비교하는 것이 더 효과적입니다.
2.  **Dispersion 기술**: 각 그룹에 대한 연령의 **분산(variance)** 또는 **표준편차(standard deviation)**를 직접 계산하여 비교합니다.
    *   Kyphosis 발생 그룹의 연령 분산: $\text{Var}(\text{Age} | \text{Kyphosis}=1)$
    *   Kyphosis 미발생 그룹의 연령 분산: $\text{Var}(\text{Age} | \text{Kyphosis}=0)$

#### **R 코드 (R Code)**

```R
# 1. 시각화
# install.packages("ggplot2") # 필요 시 설치
library(ggplot2)

# 상자 그림(Boxplot)
p_box <- ggplot(kyphosis_data, aes(x = factor(Kyphosis), y = Age)) +
  geom_boxplot() +
  labs(x = "Kyphosis 발생 여부 (0=없음, 1=있음)", y = "수술 시 연령 (개월)") +
  ggtitle("그룹별 연령 분포 (상자 그림)")

print(p_box)

# 밀도 그림(Density Plot)
p_density <- ggplot(kyphosis_data, aes(x = Age, fill = factor(Kyphosis))) +
  geom_density(alpha = 0.5) +
  labs(x = "수술 시 연령 (개월)", y = "밀도", fill = "Kyphosis") +
  ggtitle("그룹별 연령 분포 (밀도 그림)")

print(p_density)

# 2. Dispersion(분산/표준편차) 계산
dispersion_stats <- aggregate(Age ~ Kyphosis, data = kyphosis_data, 
                              FUN = function(x) c(mean = mean(x), sd = sd(x), var = var(x)))

print("b. 그룹별 연령의 기술 통계 (평균, 표준편차, 분산)")
print(dispersion_stats)
```

### **c. 제곱항을 포함한 로지스틱 회귀모형 적합, 검정 및 해석**

#### **식 (Formulation)**

1.  **이차 로지스틱 회귀 모델**:

$$ \text{logit}[\pi(x)] = \alpha + \beta_1 x + \beta_2 x^2 $$

이 모델은 연령($x$)과 Kyphosis 발생 확률($\pi$) 간의 관계가 단순한 선형이 아닌, **곡선(포물선)** 형태일 가능성을 고려합니다.

2.  **제곱항의 유의성 검정**:
    이는 $H_0: \beta_2 = 0$을 검정하는 것과 같습니다.
    *   **왈드 검정**: 모델 적합 결과에서 $\hat{\beta}_2$에 대한 z-통계량과 P-값을 확인합니다.
    *   **가능도비 검정**: 더 신뢰할 수 있는 방법.
        *   **전체 모델($M_1$)**: $\text{logit}[\pi(x)] = \alpha + \beta_1 x + \beta_2 x^2$
        *   **축소 모델($M_0$)**: $\text{logit}[\pi(x)] = \alpha + \beta_1 x$ (a에서 적합한 모델)
        *   $G^2 = -2(L_0 - L_1)$을 계산하고, 자유도 1인 $\chi^2$ 분포와 비교합니다.

3.  **적합 곡선 시각화**:
    모델에서 얻은 예측 확률 $\hat{\pi}(x)$를 연령 $x$의 범위에 걸쳐 계산하고, 이를 원래 데이터와 함께 그래프로 그립니다.

#### **R 코드 (R Code)**

```R
# 1. 이차 로지스틱 회귀 모델 적합
# I(Age^2)를 사용하여 모델 공식 내에서 제곱항 생성
model_c <- glm(Kyphosis ~ Age + I(Age^2), data = kyphosis_data, family = binomial(link = "logit"))

# 2. 제곱항 유의성 검정
# 모델 요약 (Wald 검정)
print("c. 이차 로지스틱 회귀 모델 적합 결과")
print(summary(model_c))

# 가능도비 검정 (model_a와 model_c 비교)
lrt_result_c <- anova(model_a, model_c, test = "LRT")
print("--- 제곱항 추가에 대한 가능도비 검정 결과 ---")
print(lrt_result_c)

# 3. 적합 곡선 시각화
# 예측을 위한 연령 범위 생성
age_range <- data.frame(Age = seq(min(kyphosis_data$Age), max(kyphosis_data$Age), length.out = 100))

# 예측 확률 계산
age_range$Predicted_Prob <- predict(model_c, newdata = age_range, type = "response")

# 원본 데이터와 적합 곡선을 함께 플로팅
p_fit_curve <- ggplot(kyphosis_data, aes(x = Age, y = Kyphosis)) +
  geom_point(alpha = 0.5, position = position_jitter(width=0, height=0.05)) + # jitter로 점 겹침 방지
  geom_line(data = age_range, aes(x = Age, y = Predicted_Prob), color = "blue", size = 1) +
  labs(x = "수술 시 연령 (개월)", y = "Kyphosis 발생 여부") +
  ggtitle("이차 로지스틱 회귀 적합 곡선")

print(p_fit_curve)
```
