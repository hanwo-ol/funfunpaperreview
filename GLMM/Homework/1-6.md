네, 과제 1의 6번 문제를 푸는 과정을 수학적 전개와 R 코드로 나누어 제시하겠습니다.

---

### **문제 분석 및 데이터**

이 문제는 환자의 진단 결과(5개 범주)와 약 처방 여부(2개 범주) 사이의 연관성을 분석하는 것입니다.

**주어진 데이터 (관측도수):**
| 진단 결과(Diagnosis) | **예(Yes)** | **아니오(No)** |
| :--- | :--- | :--- |
| **신경쇠약** | 105 | 8 |
| **정서장애** | 12 | 2 |
| **노이로제** | 18 | 19 |
| **인격장애** | 47 | 52 |
| **특이증상** | 0 | 13 |

### **a. 독립성검정을 위한 P-값을 구하고 그 결과를 해석하라.**

#### **식 (Formulation)**

독립성 검정을 위해 **피어슨 카이제곱 검정($X^2$)** 또는 **우도비 검정($G^2$)**을 사용합니다.

1.  **귀무가설 ($H_0$)**: 진단 결과와 약 처방 여부는 서로 독립이다.
2.  **기대도수 ($\hat{\mu}_{ij}$)** 계산:
    $$ \hat{\mu}_{ij} = \frac{(i\text{번째 행의 합계}) \times (j\text{번째 열의 합계})}{\text{전체 합계}} $$
3.  **검정 통계량 ($X^2$)** 계산:
    $$ X^2 = \sum_{i,j} \frac{(n_{ij} - \hat{\mu}_{ij})^2}{\hat{\mu}_{ij}} $$
4.  **자유도 (df)** 계산:
    $$ \text{df} = (I-1) \times (J-1) = (\text{행 개수}-1) \times (\text{열 개수}-1) $$
5.  **P-값** 계산:
    $$ \text{P-값} = P(\chi^2_{\text{df}} \ge X^2_{\text{obs}}) $$

#### **R 코드 (R Code)**

```R
# 1. 관측도수 데이터로 행렬 생성
diagnosis_data <- matrix(c(105, 12, 18, 47, 0, 8, 2, 19, 52, 13),
                         nrow = 5,
                         byrow = FALSE)

# 행과 열 이름 설정
dimnames(diagnosis_data) <- list(
  Diagnosis = c("신경쇠약", "정서장애", "노이로제", "인격장애", "특이증상"),
  Prescription = c("예", "아니오")
)

print("--- 관측도수 표 ---")
print(diagnosis_data)

# 2. 카이제곱 독립성 검정 수행
chi_test_a <- chisq.test(diagnosis_data)
# R의 chisq.test는 Yates' continuity correction을 2x2 표에서 기본으로 사용하지만,
# 더 큰 표에서는 사용하지 않음. simulate.p.value=TRUE를 사용하면 더 정확한 p-값을 얻을 수 있음.

# 3. 결과 출력
print("a. 독립성 검정 결과")
print(chi_test_a)
```

### **b. 표준화잔차를 계산하고 그 결과를 해석하라.**

#### **식 (Formulation)**

**표준화 잔차(Standardized Residual)**는 각 셀이 독립성 가정에서 얼마나 벗어났는지를 나타내는 $N(0,1)$을 근사적으로 따르는 척도입니다.
$$ r_{ij} = \frac{n_{ij} - \hat{\mu}_{ij}}{\sqrt{\hat{\mu}_{ij}(1 - p_{i+})(1 - p_{+j})}} $$
여기서 $n_{ij}$는 관측도수, $\hat{\mu}_{ij}$는 기대도수, $p_{i+}$와 $p_{+j}$는 각각 행과 열의 주변 비율입니다.

#### **R 코드 (R Code)**

```R
# 1. a에서 수행한 chisq.test 결과에서 표준화 잔차 추출
standardized_residuals_b <- chi_test_a$stdres

# 2. 결과 출력
print("b. 표준화 잔차")
print(standardized_residuals_b)
```

### **c. 진단 결과 간의 차이와 유사성을 나타내기 위해 카이제곱을 세 부분으로 분할하고자 한다...**

#### **식 (Formulation)**

**카이제곱 분할(Partitioning Chi-Squared)**은 전체 분할표의 카이제곱 통계량($X^2$)을 서로 독립적인 부분표(subtable)들의 카이제곱 통계량 합으로 분해하는 기법입니다.

1.  **(i) 처음 두 행 비교**:
    *   **부분표 1**: '신경쇠약'과 '정서장애' 행만으로 구성된 $2 \times 2$ 표.
    *   **검정**: 이 부분표에 대한 카이제곱 검정($X^2_1$)을 수행 (df=1).

2.  **(ii) 세 번째와 네 번째 행 비교**:
    *   **부분표 2**: '노이로제'와 '인격장애' 행만으로 구성된 $2 \times 2$ 표.
    *   **검정**: 이 부분표에 대한 카이제곱 검정($X^2_2$)을 수행 (df=1).

3.  **(iii) 그룹 간 비교**:
    *   **데이터 변환**:
        *   그룹 1: '신경쇠약'과 '정서장애' 행을 합친 새로운 행.
        *   그룹 2: '노이로제'와 '인격장애' 행을 합친 새로운 행.
        *   그룹 3: '특이증상' 행.
    *   **부분표 3**: 이 세 개의 그룹화된 행으로 구성된 $3 \times 2$ 표.
    *   **검정**: 이 새로운 $3 \times 2$ 표에 대한 카이제곱 검정($X^2_3$)을 수행 (df=2).

이 분할이 유효하다면(orthogonal partitioning), 다음 관계가 근사적으로 성립합니다.
*   **카이제곱 합**: $X^2_{\text{전체}} \approx X^2_1 + X^2_2 + X^2_3$
*   **자유도 합**: $\text{df}_{\text{전체}} = \text{df}_1 + \text{df}_2 + \text{df}_3 \implies 4 = 1 + 1 + 2$

#### **R 코드 (R Code)**

```R
# (i) 처음 두 행 비교
subtable_1 <- diagnosis_data[c("신경쇠약", "정서장애"), ]
chi_test_c1 <- chisq.test(subtable_1)
print("c-(i). 처음 두 행 비교 (신경쇠약 vs. 정서장애)")
print(chi_test_c1)

# (ii) 세 번째와 네 번째 행 비교
subtable_2 <- diagnosis_data[c("노이로제", "인격장애"), ]
chi_test_c2 <- chisq.test(subtable_2)
print("c-(ii). 세 번째와 네 번째 행 비교 (노이로제 vs. 인격장애)")
print(chi_test_c2)

# (iii) 그룹 간 비교
# 그룹화된 행 생성
group1 <- colSums(diagnosis_data[c("신경쇠약", "정서장애"), ])
group2 <- colSums(diagnosis_data[c("노이로제", "인격장애"), ])
group3 <- diagnosis_data["특이증상", ]

# 그룹화된 표 생성
subtable_3 <- rbind(group1, group2, group3)
rownames(subtable_3) <- c("신경쇠약/정서장애", "노이로제/인격장애", "특이증상")

chi_test_c3 <- chisq.test(subtable_3)
print("c-(iii). 그룹 간 비교")
print(chi_test_c3)

# 분할 검증
total_X_squared_partition <- chi_test_c1$statistic + chi_test_c2$statistic + chi_test_c3$statistic
print("--- 분할된 카이제곱 값들의 합 ---")
print(total_X_squared_partition)
print("--- 전체 카이제곱 값 (a에서 계산) ---")
print(chi_test_a$statistic)
```
