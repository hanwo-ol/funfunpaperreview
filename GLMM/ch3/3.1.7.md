### **3.1.7 로그 오즈비에 대한 델타 방법 (Delta Method for the Log Odds Ratio)**

**[원문 번역]**

로그 오즈비와 로그 상대위험도에 대한 표준오차는 다변량 버전의 델타 방법으로부터 나옵니다. $\{n_i, i=1, \dots, c\}$가 다항분포 $(n, \{\pi_i\})$를 따른다고 가정합시다. 표본 비율 $\hat{\pi}_i = n_i/n$은 평균과 분산을 가집니다.

$$ E(\hat{\pi}_i) = \pi_i \quad \text{이고} \quad \text{var}(\hat{\pi}_i) = \pi_i(1-\pi_i)/n \quad (3.7) $$

16.1.4절에서 우리는 $i \neq j$일 때, $\hat{\pi}_i$와 $\hat{\pi}_j$가 다음의 공분산을 가짐을 보입니다.

$$ \text{cov}(\hat{\pi}_i, \hat{\pi}_j) = -\pi_i \pi_j / n \quad (3.8) $$

표본 비율들 $(\hat{\pi}_1, \hat{\pi}_2, \dots, \hat{\pi}_{c-1})$은 대푯본 다변량 정규분포를 가집니다. 이들의 함수에 대해, 델타 방법은 16.1.4절에서 증명되는 다음의 결과를 암시합니다:

$\{\pi_i\}$의 미분 가능한 함수를 $g(\boldsymbol{\pi})$라고 하고, 다항 표본에 대한 그 표본 값을 $g(\hat{\boldsymbol{\pi}})$라고 합시다.

$$ \phi_i = \frac{\partial g(\boldsymbol{\pi})}{\partial \pi_i}, \quad i=1, \dots, c $$

라고 둡시다. 그러면 $n \to \infty$ 일 때, $\sqrt{n}[g(\hat{\boldsymbol{\pi}}) - g(\boldsymbol{\pi})]/\sigma$의 분포는 표준정규분포로 수렴하며, 여기서

$$ \sigma^2 = \sum_i \pi_i \phi_i^2 - \left(\sum_i \pi_i \phi_i\right)^2 \quad (3.9) $$

입니다.

점근적 분산은 $\{\pi_i\}$와 $\{\pi_i\}$에 대한 측도의 편도함수들에 의존합니다. 실제로는 (3.9)의 $\{\pi_i\}$와 $\{\phi_i\}$를 그들의 표본 값으로 대체하여 $\sigma^2$의 ML 추정치 $\hat{\sigma}^2$를 얻습니다. 그러면 $\hat{\sigma}/\sqrt{n}$이 $g(\hat{\boldsymbol{\pi}})$의 추정된 표준오차가 됩니다. $g(\boldsymbol{\pi})$에 대한 대푯본 왈드 신뢰구간은 다음과 같습니다.

$$ g(\hat{\boldsymbol{\pi}}) \pm z_{\alpha/2}\hat{\sigma}/\sqrt{n} $$

이제 우리는 델타 방법을 로그 오즈비에 적용하여, $g(\boldsymbol{\pi}) = \log\theta = \log\pi_{11} + \log\pi_{22} - \log\pi_{12} - \log\pi_{21}$로 둡니다.

$$ \phi_{11} = \frac{\partial(\log\theta)}{\partial\pi_{11}} = 1/\pi_{11} $$

$$ \phi_{12} = -1/\pi_{12}, \quad \phi_{21} = -1/\pi_{21}, \quad \phi_{22} = 1/\pi_{22} $$

이므로, $\sum_i \sum_j \pi_{ij}\phi_{ij} = 1 - 1 - 1 + 1 = 0$ 이고,

$$ \sigma^2 = \sum_i \sum_j \pi_{ij}\phi_{ij}^2 = \sum_i \sum_j (1/\pi_{ij}) $$

입니다. 다항 표본 $\{n_{ij}\}$에 대한 $\log\hat{\theta}$의 표준오차는 다음과 같습니다.

$$ \sigma(\log\hat{\theta}) = \sigma/\sqrt{n} = \sqrt{\sum\sum 1/(n\pi_{ij})} $$

$n\pi_{ij}$가 $\mu_{ij} = E(n_{ij})$이므로, 추정된 표준오차는 (3.1)입니다.

---

### **핵심 내용 해설: 다변량 델타 방법과 오즈비**

이 섹션은 단일 변수 델타 방법(3.1.5절)을 **여러 변수**를 다루는 경우로 확장하고, 이를 이용해 **로그 오즈비의 표준오차 공식 (3.1)을 수학적으로 유도**하는 과정을 보여줍니다.

#### **1. 왜 다변량(Multivariate) 버전이 필요한가?**

*   **로그 오즈비**: $\log \theta = \log\left(\frac{\pi_{11}\pi_{22}}{\pi_{12}\pi_{21}}\right)$는 4개의 셀 확률($\pi_{11}, \pi_{12}, \pi_{21}, \pi_{22}$) 모두의 함수입니다.
*   **다항 표본 비율의 특징**: 이 4개의 표본 비율($\hat{\pi}_{11}, \dots, \hat{\pi}_{22}$)은 서로 **독립이 아닙니다**. 하나의 비율이 커지면 (예: $\hat{\pi}_{11}$ 증가), 다른 비율들은 작아져야만 합니다 (총합이 1이므로). 이러한 **음의 상관관계(공분산)**를 고려해야 합니다.
*   **다변량 델타 방법**: 이 방법은 여러 변수들의 함수에 대한 분산을 구할 때, 각 변수의 분산뿐만 아니라 변수들 간의 **공분산**까지 모두 고려합니다.

#### **2. 다변량 델타 방법의 공식 (3.9)**

본문에 나온 공식 (3.9)는 다변량 델타 방법의 최종 결과입니다.

$$ \sigma^2 = \text{Var}(\sqrt{n} \cdot g(\hat{\boldsymbol{\pi}})) = \sum_i \pi_i \phi_i^2 - \left(\sum_i \pi_i \phi_i\right)^2 $$

*   $\boldsymbol{\phi}$: 함수 $g$를 각 변수 $\pi_i$로 편미분한 값들의 벡터(기울기 벡터, gradient)입니다.
*   $\sum \pi_i \phi_i^2$: 각 편미분 제곱의 가중평균과 관련됩니다 ($E[\phi^2]$와 유사).
*   $(\sum \pi_i \phi_i)^2$: 편미분 가중평균의 제곱과 관련됩니다 ($(E[\phi])^2$와 유사).

이 공식은 행렬 형태로 표현된 일반적인 다변량 델타 방법($\text{Var}(g(\hat{\boldsymbol{\pi}})) \approx (\nabla g)^T \mathbf{\Sigma} (\nabla g)$)을 다항 분포의 공분산 구조에 맞게 정리한 것입니다.

#### **3. 로그 오즈비 표준오차 공식 유도 과정**

이제 이 공식 (3.9)를 사용하여 로그 오즈비의 점근적 분산을 구해보겠습니다.

**1단계: 함수 $g(\boldsymbol{\pi})$와 편도함수 $\phi_{ij}$ 정의**
*   **함수**: $g(\boldsymbol{\pi}) = \log \theta = \log\pi_{11} + \log\pi_{22} - \log\pi_{12} - \log\pi_{21}$
*   **편도함수 (기울기)**: 함수 $g$를 각 셀 확률 $\pi_{ij}$에 대해 편미분합니다.
    *   $\phi_{11} = \frac{\partial g}{\partial\pi_{11}} = \frac{1}{\pi_{11}}$ (오직 $\log\pi_{11}$ 항만 $\pi_{11}$을 포함)
    *   $\phi_{12} = \frac{\partial g}{\partial\pi_{12}} = -\frac{1}{\pi_{12}}$ (오직 $-\log\pi_{12}$ 항만 $\pi_{12}$을 포함)
    *   $\phi_{21} = \frac{\partial g}{\partial\pi_{21}} = -\frac{1}{\pi_{21}}$
    *   $\phi_{22} = \frac{\partial g}{\partial\pi_{22}} = \frac{1}{\pi_{22}}$

**2단계: 공식 (3.9)의 두 항 계산**
*   **두 번째 항 계산**: $\sum_i \sum_j \pi_{ij}\phi_{ij}$
    *   $= \pi_{11}\phi_{11} + \pi_{12}\phi_{12} + \pi_{21}\phi_{21} + \pi_{22}\phi_{22}$
    *   $= \pi_{11}\left(\frac{1}{\pi_{11}}\right) + \pi_{12}\left(-\frac{1}{\pi_{12}}\right) + \pi_{21}\left(-\frac{1}{\pi_{21}}\right) + \pi_{22}\left(\frac{1}{\pi_{22}}\right)$
    *   $= 1 - 1 - 1 + 1 = \mathbf{0}$
*   **첫 번째 항 계산**: $\sum_i \sum_j \pi_{ij}\phi_{ij}^2$
    *   $= \pi_{11}\phi_{11}^2 + \pi_{12}\phi_{12}^2 + \pi_{21}\phi_{21}^2 + \pi_{22}\phi_{22}^2$
    *   $= \pi_{11}\left(\frac{1}{\pi_{11}}\right)^2 + \pi_{12}\left(-\frac{1}{\pi_{12}}\right)^2 + \pi_{21}\left(-\frac{1}{\pi_{21}}\right)^2 + \pi_{22}\left(\frac{1}{\pi_{22}}\right)^2$
    *   $= \frac{1}{\pi_{11}} + \frac{1}{\pi_{12}} + \frac{1}{\pi_{21}} + \frac{1}{\pi_{22}}$

**3단계: $\sigma^2$ 최종 계산**
*   $\sigma^2 = (\text{첫 번째 항}) - (\text{두 번째 항})^2$
*   $\sigma^2 = \left(\frac{1}{\pi_{11}} + \frac{1}{\pi_{12}} + \frac{1}{\pi_{21}} + \frac{1}{\pi_{22}}\right) - (0)^2 = \frac{1}{\pi_{11}} + \frac{1}{\pi_{12}} + \frac{1}{\pi_{21}} + \frac{1}{\pi_{22}}$

**4단계: $\log\hat{\theta}$의 분산 및 표준오차 구하기**
*   위에서 구한 $\sigma^2$은 $\text{Var}(\sqrt{n} \cdot g(\hat{\boldsymbol{\pi}}))$ 입니다.
*   우리가 원하는 $\text{Var}(g(\hat{\boldsymbol{\pi}})) = \text{Var}(\log\hat{\theta})$는 $\sigma^2$을 $n$으로 나눈 값입니다.

$$ \text{Asy. Var}(\log\hat{\theta}) = \frac{\sigma^2}{n} = \frac{1}{n}\left(\frac{1}{\pi_{11}} + \frac{1}{\pi_{12}} + \frac{1}{\pi_{21}} + \frac{1}{\pi_{22}}\right) = \frac{1}{n\pi_{11}} + \frac{1}{n\pi_{12}} + \frac{1}{n\pi_{21}} + \frac{1}{n\pi_{22}} $$

*   여기에 제곱근을 취하여 **표준오차**를 구하고, 모르는 $\pi_{ij}$를 추정치 $\hat{\pi}_{ij} = n_{ij}/n$으로 대체하면 **추정된 표준오차**를 얻습니다.

$$ \hat{\sigma}(\log\hat{\theta}) = \sqrt{\frac{1}{n\hat{\pi}_{11}} + \frac{1}{n\hat{\pi}_{12}} + \frac{1}{n\hat{\pi}_{21}} + \frac{1}{n\hat{\pi}_{22}}} $$

$$ = \sqrt{\frac{1}{n(n_{11}/n)} + \frac{1}{n(n_{12}/n)} + \frac{1}{n(n_{21}/n)} + \frac{1}{n(n_{22}/n)}} $$

$$ = \sqrt{\frac{1}{n_{11}} + \frac{1}{n_{12}} + \frac{1}{n_{21}} + \frac{1}{n_{22}}} $$

이것이 바로 본문의 수식 (3.1)입니다. 이 유도 과정은 델타 방법이 어떻게 복잡한 통계량의 불확실성을 체계적으로 계산하는지를 보여주는 대표적인 예입니다.
