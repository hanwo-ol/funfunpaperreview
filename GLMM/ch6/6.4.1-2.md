### 6.4.1 로지스틱 모델을 이용한 조건부 독립성 검정 (Using Logistic Models to Test Conditional Independence)

[원문 번역]

이항 반응 Y에 대해, 우리는 질적 공변량 Z의 범주에 대해 조건화하여 이항 예측 변수 X의 효과를 분석한다. $\pi_{ik} = P(Y=1 | X=i, Z=k)$라고 하자. 다음 모델을 고려하자.

$$ \text{logit}(\pi_{ik}) = \alpha + \beta x_i + \beta_k^Z, \quad i=1,2, \quad k=1,\dots,K \quad (6.4) $$

여기서 $x_1=1$이고 $x_2=0$이다. 이 모델은 XY 조건부 오즈비가 Z의 각 범주에서 동일, 즉 $\exp(\beta)$라고 가정한다. XY 조건부 독립성의 귀무가설은 $H_0: \beta=0$이다. 왈드 통계량은 $(\hat{\beta}/\text{SE})^2$이다. 우도비 통계량은 축소된 모델

$$ \text{logit}(\pi_{ik}) = \alpha + \beta_k^Z \quad (6.5) $$

과 전체 모델에 대한 이탈도 통계량 간의 차이이다. 이러한 검정들은 X가 Z의 각 범주에서 유사한 효과를 가질 때 합리적이다. 그들은 df=1을 갖는다.

대안적으로, 축소된 모델 (6.5)가 X와 Y의 조건부 독립성과 동등하므로, 우리는 그 모델의 적합도 검정을 사용하여 조건부 독립성을 검정할 수 있다. 그러한 검정은 X가 이항일 때 df=K를 갖는다. 이것은 모델 (6.5)를 포화 모델과 비교하는 것에 해당하며, 포화 모델은 (6.4)에서 $\beta \neq 0$을 허용하고 또한 $(K-1)$개의 XZ 상호작용 모수를 포함한다. 상호작용이 없거나 조건부 XY 연관성이 Z의 수준들 사이에서 변동이 거의 없을 때, 5.3.7절의 결과로부터 조건부 독립성을 검정하는 df=K를 사용하는 접근법은 K가 클 때 특히 덜 강력하다는 것을 알 수 있다. 모델 (6.4)가 성립할 때, 두 검정은 동일한 비중심도(noncentrality)를 갖는다. 따라서, 모델 (6.4)에서의 $\beta=0$ 검정은 더 적은 자유도를 사용하므로 더 강력하다. 하지만, 조건부 XY 연관성의 방향이 Z의 범주에 따라 변할 때, 그것은 덜 강력할 수 있다.

### 6.4.2 코크란-맨텔-헨젤 조건부 독립성 검정 (Cochran–Mantel–Haenszel Test of Conditional Independence)

[원문 번역]

Mantel과 Haenszel(1959)은 $2 \times 2 \times K$ 표에서의 $H_0$: 조건부 독립성에 대한 비-모델-기반 검정을 제안했다. 질병에 대한 후향적 연구에 초점을 맞춰, 그들은 반응(열) 주변 총합을 고정된 것으로 취급했다. 따라서, 셀 빈도 $\{n_{ijk}\}$의 각 부분표 $k$에서, 그들의 분석은 치료(예: 그룹) 총합 $\{n_{1+k}, n_{2+k}\}$과 반응 결과 총합 $\{n_{+1k}, n_{+2k}\}$ 모두에 대해 조건화했다. 통상적인 표집 방식들은 그러면 각 부분표의 첫 번째 셀 빈도 $n_{11k}$에 대해 초기하분포 (3.17)를 산출한다. 그 빈도는 주변 총합이 주어졌을 때 $\{n_{12k}, n_{21k}, n_{22k}\}$를 결정한다.

$H_0$ 하에서, $n_{11k}$의 초기하 평균과 분산은

$$ \mu_{11k} = E(n_{11k}) = n_{1+k}n_{+1k}/n_{++k} $$

$$ \text{var}(n_{11k}) = n_{1+k}n_{2+k}n_{+1k}n_{+2k} / [n_{++k}^2(n_{++k}-1)] $$

이다. 다른 부분표들로부터의 셀 빈도들은 독립이다. 검정 통계량은 $\sum_k n_{11k}$를 그것의 귀무 기댓값과 비교함으로써 $K$개 표로부터의 정보를 결합한다. 그것은 다음과 같다.

$$ \text{CMH} = \frac{[\sum_k(n_{11k} - \mu_{11k})]^2}{\sum_k \text{var}(n_{11k})} \quad (6.6) $$

이 통계량은 대푯본에서 df=1인 카이제곱 귀무분포를 갖는다.

부분표 $k$에서 오즈비 $\theta_{XY(k)}>1$일 때, 우리는 $(n_{11k}-\mu_{11k})>0$을 기대한다. 모든 부분표에서 $\theta_{XY(k)}>1$이거나 각 표에서 $\theta_{XY(k)}<1$일 때, $\sum_k(n_{11k}-\mu_{11k})$는 절댓값에서 상대적으로 커지는 경향이 있다. 이 검정은 조건부 XY 연관성이 각 부분표에서 유사할 때 가장 잘 작동한다. 이런 의미에서 그것은 로지스틱 모델 (6.4)에서의 $H_0: \beta=0$ 검정과 유사하다. 층(strata) 내의 표본 크기가 적당히 클 때, 이 검정은 보통 유사한 결과를 준다. 사실, 그것은 그 모델에서의 $H_0: \beta=0$에 대한 스코어 검정이다 (Birch 1964b, 1965, Darroch 1981, Day and Byar 1979).

---

### 핵심 내용 해설: 교란 변수 통제하의 연관성 검정

이 섹션들은 2.3절에서 소개된 조건부 연관성의 개념을 추론(inference)의 영역으로 가져옵니다. 즉, "제3의 변수 Z를 통제(고정)했을 때, X와 Y 사이에 관찰된 연관성이 통계적으로 유의미한가?"라는 질문에 답하는 방법입니다.

#### 6.4.1: 모델 기반 접근법 (로지스틱 회귀)

*   아이디어: 로지스틱 회귀의 다중 회귀 기능을 이용하여 교란 변수 Z를 통제한다.
*   모델 (균일 연관성 모델):

$$ \text{logit}(\pi_{ik}) = \alpha + \beta x_i + \beta_k^Z $$

*   $\beta$: Z의 수준과 관계없이 모든 층에서 동일하다고 가정되는 X와 Y의 공통 로그 오즈비.
    *   $\beta_k^Z$: Z의 효과를 나타내는 항들 (지시 변수 사용). 이 항들이 모델에 포함됨으로써 Z의 효과가 '통제'된다.
*   조건부 독립성 검정:
    *   질문: "Z를 통제했을 때, X와 Y는 연관성이 있는가?"
    *   귀무가설: $H_0: \beta=0$ (공통 조건부 오즈비가 1이다).
*   검정 방법:
    1.  왈드/우도비/스코어 검정 (df=1): 위의 모델 (6.4)를 적합하고, $\beta$에 대한 검정을 수행한다. 이는 $\beta=0$이라는 단일 모수를 검정하므로 자유도가 1이다. 이 방법은 "X와 Y의 연관성이 모든 층에서 동일하다(균일 연관성)"는 가정을 전제로 한다.
    2.  적합도 검정 (df=K): Z만 포함된 모델 (6.5), 즉 $\text{logit}(\pi_{ik}) = \alpha + \beta_k^Z$를 적합하고, 이 모델의 적합도를 검정한다. 이 모델 자체가 "X와 Y가 Z에 대해 조건부로 독립"이라는 가설을 의미하기 때문이다. 이 검정은 포화 모델과 비교하는 것이므로, 자유도는 (포화 모델 모수) - (모델 6.5 모수) = $2K - (K+1) = K-1$이 된다.
*   어느 방법이 더 좋은가?:
    *   만약 연관성이 실제로 모든 층에서 비슷하다면(균일 연관성), df=1 검정이 더 집중되어 있으므로 훨씬 강력(powerful)하다.
    *   만약 연관성의 방향이 층마다 다르다면(상호작용이 있다면), df=1 검정은 효과를 제대로 감지하지 못할 수 있고, 이 경우 df=K-1 검정이 더 나을 수 있다.

#### 6.4.2: 비-모델 기반 접근법 (CMH 검정)

*   아이디어: 각 $2 \times 2$ 부분표는 독립성에 대한 약간의 정보를 담고 있다. 이 정보들을 모델 가정 없이 직접 합쳐서 전체적인 증거를 만들자.
*   코크란-맨텔-헨젤(CMH) 검정의 절차:
    1.  각 부분표($k$) 내에서: 행과 열 총합을 모두 고정시킨다(피셔의 정확 검정과 동일한 조건). 그러면 셀 빈도 $n_{11k}$는 초기하분포를 따른다.
    2.  관측값 vs. 기대값: 각 표에서 관측된 $n_{11k}$와, 독립성 하에서 기대되는 $\mu_{11k}$ 사이의 차이($n_{11k}-\mu_{11k}$)를 계산한다. 이 차이가 0보다 크면 양의 연관성, 작으면 음의 연관성을 시사한다.
    3.  정보 종합: 모든 $K$개의 표에 대해 이 차이들을 모두 더한다 ($\sum_k(n_{11k} - \mu_{11k})$). 만약 모든 표에서 연관성의 방향이 같다면, 이 합의 절댓값은 커질 것이다.
    4.  표준화: 이 합계를 그것의 표준오차($\sqrt{\sum_k \text{var}(n_{11k})}$)로 나누고 제곱한다. 이것이 CMH 통계량이다.
*   결과: CMH 통계량은 근사적으로 자유도 1인 카이제곱 분포를 따른다.

#### 두 방법의 놀라운 연결

*   겉보기에는 로지스틱 회귀(모델 기반)와 CMH 검정(비-모델 기반)은 매우 달라 보이지만, 수학적으로 이 둘은 깊이 연결되어 있다.
*   CMH 검정 = 스코어 검정: CMH 통계량은, 균일 연관성 로지스틱 모델 (6.4)에서 $H_0: \beta=0$을 검정하는 스코어 검정 통계량과 점근적으로 동일하다.

결론:
*   "Z를 통제한 상태에서 X와 Y가 독립인가?"라는 질문에 답하기 위해 우리는 두 가지 주요 도구를 가지고 있다.
    1.  로지스틱 회귀: 모델을 명시적으로 가정하고, $\beta=0$에 대한 우도비 또는 왈드 검정을 수행한다. 더 유연하고(상호작용 검정 등), 효과의 크기($\hat{\beta}$)와 신뢰구간까지 제공한다.
    2.  CMH 검정: 모델을 가정하지 않고, 각 층의 정보를 영리하게 종합한다. 특히 데이터가 희소(sparse)할 때(각 층의 데이터가 적을 때) 로지스틱 회귀보다 더 안정적인 성능을 보인다.
*   두 방법은 동일한 가설(균일 연관성 하의 조건부 독립성)을 검정하며, 데이터가 충분할 때는 매우 유사한 결과를 제공한다.
